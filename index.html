<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nakato Jane Voice Assistant</title>
  <style>
    body { font-family: Segoe UI, Tahoma, Geneva, Verdana, sans-serif; margin:0; padding:20px; background:linear-gradient(135deg,#6A4C93,#9B5DE5,#CE96FB); color:#fff; min-height:100vh; display:flex; align-items:center; justify-content:center; }
    .container { max-width:640px; width:100%; padding:32px; border-radius:16px; background:rgba(255,255,255,.12); box-shadow:0 8px 32px rgba(0,0,0,.3); text-align:center; }
    h1{margin:0 0 6px} .subtitle{margin:0 0 16px; opacity:.9}
    .mic-button{ width:110px; height:110px; border-radius:50%; border:none; color:#fff; font-size:44px; cursor:pointer; background:linear-gradient(45deg,#ff6b6b,#4ecdc4); box-shadow:0 4px 15px rgba(0,0,0,.3); transition:transform .15s ease }
    .mic-button:hover{ transform:scale(1.05) } .mic-button.listening{ background:linear-gradient(45deg,#ff4757,#ff3838) }
    .status{ margin:12px 0 16px; font-size:18px } .response{ display:none; text-align:left; background:rgba(0,0,0,.25); padding:14px; border-radius:10px }
    .row{ margin-top:12px; display:flex; gap:8px; justify-content:center; flex-wrap:wrap } .btn{ background:rgba(255,255,255,.15); color:#fff; border:none; padding:10px 14px; border-radius:10px; cursor:pointer }
    .btn:hover{ background:rgba(255,255,255,.25) } input[type=file]{ display:none } .foot{ margin-top:12px; opacity:.8; font-size:13px }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸŽ¤ Nakato Jane</h1>
  <div class="subtitle">Hands-free assistant using your device's voice</div>

    <button id="micButton" class="mic-button" onclick="toggleListening()">ðŸŽ¤</button>
    <div id="status" class="status">Tap microphone to speak</div>
    <div id="response" class="response"></div>

  <div class="foot">No server needed. Uses browser speech recognition and voice.</div>
  </div>

  <script>
  // No server config needed

    // State
    let isListening = false;
    let isSpeaking = false;
    let autoListenEnabled = true;
    let recognition = null;
  // No uploaded voice in this minimal version

    // Initialize STT (hands-free)
    function initializeSpeechRecognition() {
      if (!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)) {
        setStatus('Speech recognition not supported on this browser');
        return;
      }
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SR();
      recognition.lang = 'en-US';
      recognition.continuous = true; // keep running
      recognition.interimResults = true;

      recognition.onstart = () => setStatus('ðŸŽ¤ Listening...');

      recognition.onresult = (e) => {
        let text = '';
        for (let i = e.resultIndex; i < e.results.length; i++) text += e.results[i][0].transcript;
        const latest = e.results[e.results.length - 1];
        if (latest && latest.isFinal) {
          // pause listening while thinking/speaking to avoid feedback
          stopListening();
          processVoiceInput(text.trim());
        }
      };

      recognition.onerror = (e) => {
        setStatus('Error: ' + e.error);
        // try to recover hands-free if allowed
        if (autoListenEnabled && !isSpeaking) safeRestartListening(1200);
      };

      recognition.onend = () => {
        isListening = false;
        document.getElementById('micButton').classList.remove('listening');
        document.getElementById('micButton').textContent = 'ðŸŽ¤';
        if (autoListenEnabled && !isSpeaking) safeRestartListening(600);
      };

      // Try to start hands-free
      safeRestartListening(0);
    }

    function setStatus(text) {
      document.getElementById('status').textContent = text;
    }

    function toggleListening() { if (!isListening) startListening(); else stopListening(); }

    function startListening() {
      if (!recognition) return;
      navigator.mediaDevices.getUserMedia({ audio: true }).then((s) => {
        s.getTracks().forEach(t => t.stop()); // permission only
        if (isSpeaking) return; // don't listen over our own voice
        isListening = true;
        document.getElementById('micButton').classList.add('listening');
        document.getElementById('micButton').textContent = 'ðŸ”´';
        document.getElementById('response').style.display = 'none';
        try { recognition.start(); } catch {}
      }).catch(() => setStatus('Microphone permission is required'));
    }

    function stopListening() {
      isListening = false;
      try { recognition && recognition.stop(); } catch {}
      document.getElementById('micButton').classList.remove('listening');
      document.getElementById('micButton').textContent = 'ðŸŽ¤';
      setStatus('Tap microphone to speak');
    }

    function safeRestartListening(delayMs = 300) {
      setTimeout(() => { if (!isSpeaking) startListening(); }, delayMs);
    }

    // Core assistant flow
    function processVoiceInput(input) {
      if (!input) { if (autoListenEnabled) safeRestartListening(500); return; }
  setStatus('Thinking...');
  const reply = ruleBasedResponse(input);
  showReply(reply);
  speakPipeline(reply);
    }

    function showReply(text) {
      const el = document.getElementById('response');
      el.innerHTML = `<strong>Nakato Jane:</strong> ${text}`;
      el.style.display = 'block';
      setStatus('Responding...');
    }

  function speakPipeline(text) { speakBrowser(text); }

  // No remote TTS in this minimal version

    // Browser TTS fallback
    function speakBrowser(text) {
      if (!('speechSynthesis' in window)) { setStatus('Speech synthesis not supported'); if (autoListenEnabled) safeRestartListening(350); return; }
      isSpeaking = true;
      stopListening();
      const utter = new SpeechSynthesisUtterance(text);
      const voices = speechSynthesis.getVoices();
      const preferred = ['zira','hazel','samantha','aria','eva','female'];
      let v = voices.find(v => preferred.some(p => v.name.toLowerCase().includes(p)))
            || voices.find(v => v.lang?.startsWith('en') && !/david|male|mark/.test(v.name?.toLowerCase?.() || ''))
            || voices[0];
      if (v) utter.voice = v;
      utter.pitch = 1.5; utter.rate = 0.95; utter.volume = 1.0;
      utter.onend = () => { isSpeaking = false; if (autoListenEnabled) safeRestartListening(350); };
      utter.onerror = () => { isSpeaking = false; if (autoListenEnabled) safeRestartListening(350); };
      speechSynthesis.cancel();
      speechSynthesis.speak(utter);
    }

  // No online AI; use simple rule-based replies

    function ruleBasedResponse(input) {
      const t = (input || '').toLowerCase();
      if (/\b(hello|hi|hey)\b/.test(t)) return "Hello! I'm Nakato Jane. How can I help?";
      if (t.includes('name')) return "I'm Nakato Jane, a professional waitress and hostess at Hilton Suites.";
      if (t.includes('language')) return 'I speak English, Arabic, and Luganda.';
      if (t.includes('uganda')) return 'Uganda is the Pearl of Africaâ€”friendly people, beautiful landscapes, and rich culture!';
      if (/\b(time)\b/.test(t)) return `It is ${new Date().toLocaleTimeString()}.`;
      if (/\b(date|today)\b/.test(t)) return `Today is ${new Date().toLocaleDateString()}.`;
      if (/(menu|food|drink)/.test(t)) return 'We offer international cuisine, local specialties, and fine beverages at Hilton Suites.';
      return "I'm here to help with hospitality and general questions!";
    }

  // Removed server URL tools and upload

    // Boot
  document.addEventListener('DOMContentLoaded', () => { initializeSpeechRecognition(); });
  </script>
</body>
</html>
