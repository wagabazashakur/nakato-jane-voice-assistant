<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nakato Jane Voice Assistant - AI Powered</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #6A4C93, #9B5DE5, #CE96FB);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .container {
            text-align: center;
            max-width: 600px;
            padding: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        .subtitle {
            font-size: 1.2em;
            margin-bottom: 40px;
            opacity: 0.9;
        }
        .mic-button {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: #fff;
            border: none;
            font-size: 50px;
            color: #6A4C93;
            cursor: pointer;
            margin: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        .mic-button:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }
        .mic-button.listening {
            background: #ff4444;
            color: white;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .status {
            font-size: 1.3em;
            margin: 20px 0;
            min-height: 30px;
        }
        .response {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
        }
        .examples {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            text-align: left;
        }
        .examples h3 {
            text-align: center;
            margin-bottom: 15px;
        }
        .examples ul {
            list-style: none;
            padding: 0;
        }
        .examples li {
            margin: 8px 0;
            padding-left: 20px;
        }
        .examples li:before {
            content: "üí¨ ";
            margin-right: 10px;
        }
        .voice-clone-section {
            background: rgba(255, 255, 255, 0.15);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        .record-button {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .audio-player {
            margin: 10px 0;
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé§ Nakato Jane</h1>
        <p class="subtitle">AI-Powered Waitress & Hostess at Hilton Suites</p>
        
        <button class="mic-button" id="micButton" onclick="toggleListening()">
            üé§
        </button>
        
        <div class="status" id="status">Tap microphone to speak</div>
        
        <!-- Microphone Test Button -->
        <div style="text-align: center; margin: 10px 0;">
            <button style="background: #ff6b6b; color: white; border: none; padding: 10px 20px; border-radius: 15px; cursor: pointer;" 
                    onclick="testMicrophone()">
                üîß Test Microphone
            </button>
        </div>
        
        <div class="response" id="response"></div>
        
        <!-- AI Model Status -->
        <div style="background: rgba(76, 175, 80, 0.3); padding: 10px; border-radius: 5px; margin: 20px 0; font-size: 14px;">
            üß† <strong>AI Model: ACTIVE</strong><br>
            üí° Lightweight AI running in browser<br>
            üé§ Female voice forced for all responses<br>
            üåç Can answer any question intelligently
        </div>
        
        <!-- FREE Voice Cloning Section -->
        <div class="voice-clone-section">
            <h3>üéØ Upload Nakato Jane's Voice (FREE)</h3>
            <p>Upload audio files or record live voice samples:</p>
            
            <!-- File Upload Option -->
            <div style="margin: 15px 0;">
                <input type="file" id="voiceFileInput" accept="audio/*" multiple style="display: none;">
                <button class="record-button" onclick="document.getElementById('voiceFileInput').click()">
                    üìÅ Upload Voice Files
                </button>
                <button class="record-button" onclick="startRecording()">üéôÔ∏è Record Live</button>
                <button class="record-button" onclick="stopRecording()">‚èπÔ∏è Stop Recording</button>
            </div>
            
            <!-- Voice Samples List -->
            <div id="voiceSamplesList" style="text-align: left; margin: 10px 0;"></div>
            
            <!-- Audio Player -->
            <audio id="audioPlayer" class="audio-player" controls style="display: none;"></audio>
            <div id="recordingStatus"></div>
            
            <!-- Voice Training Controls -->
            <div style="margin-top: 15px;">
                <button class="record-button" onclick="trainVoiceModel()" style="background: #4CAF50;">
                    üß† Train Voice Model
                </button>
                <button class="record-button" onclick="testVoiceClone()" style="background: #2196F3;">
                    üéµ Test Cloned Voice
                </button>
                <button class="record-button" onclick="clearVoiceSamples()" style="background: #f44336;">
                    üóëÔ∏è Clear All Samples
                </button>
            </div>
            
            <!-- Voice Model Status -->
            <div id="voiceModelStatus" style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 5px; font-size: 14px;"></div>
            
            <!-- Voice Debug Section -->
            <div style="margin-top: 15px;">
                <button class="record-button" onclick="debugVoices()" style="background: #9C27B0;">
                    üîç Debug Voices
                </button>
                <button class="record-button" onclick="forceFemalevoice()" style="background: #E91E63;">
                    üë© Force Female Voice
                </button>
            </div>
            <div id="voiceDebugInfo" style="margin-top: 10px; font-size: 12px; max-height: 200px; overflow-y: auto;"></div>
        </div>
        
        <div class="examples">
            <h3>üí° Try asking:</h3>
            <ul>
                <li>"Tell me about your work experience at Hilton"</li>
                <li>"What languages do you speak?"</li>
                <li>"What's your favorite food to serve?"</li>
                <li>"Tell me about Uganda"</li>
                <li>"What are your future plans?"</li>
                <li>"Do you have any advice for me?"</li>
                <li>"What do you love about your work?"</li>
                <li>"How can I contact you for opportunities?"</li>
            </ul>
        </div>
        
        <div style="margin-top: 20px; font-size: 14px; opacity: 0.8;">
            üí° <strong>100% Free:</strong> No subscriptions needed! Voice samples stored locally.
        </div>
    </div>

    <script>
        let isListening = false;
        let synthesis = window.speechSynthesis;
        let mediaRecorder;
        let audioChunks = [];
        let recordedVoiceSamples = JSON.parse(localStorage.getItem('nakatoVoiceSamples')) || [];

        // Initialize speech recognition
        let recognition = null;
        
        function initializeSpeechRecognition() {
            console.log('üé§ Initializing speech recognition...');
            
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = true;
                recognition.lang = 'en-US';

                recognition.onstart = function() {
                    console.log('‚úÖ Speech recognition started');
                    document.getElementById('status').textContent = 'üé§ Listening... Speak now!';
                };

                recognition.onresult = function(event) {
                    console.log('üéØ Speech recognition result received');
                    let transcript = '';
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        transcript += event.results[i][0].transcript;
                    }
                    
                    console.log('üìù Transcript:', transcript);
                    
                    if (event.results[event.results.length - 1].isFinal) {
                        console.log('‚úÖ Final transcript:', transcript);
                        processVoiceInput(transcript);
                    }
                };

                recognition.onerror = function(event) {
                    console.error('‚ùå Speech recognition error:', event.error);
                    document.getElementById('status').textContent = 'Error: ' + event.error + ' - Try again!';
                    stopListening();
                };

                recognition.onend = function() {
                    console.log('üîö Speech recognition ended');
                    stopListening();
                };
                
                console.log('‚úÖ Speech recognition initialized successfully');
                document.getElementById('status').textContent = 'Tap microphone to speak';
            } else {
                console.error('‚ùå Speech recognition not supported');
                document.getElementById('status').textContent = 'Speech recognition not supported in this browser';
            }
        }

        function toggleListening() {
            console.log('üîÑ Toggle listening called, current state:', isListening);
            
            if (!isListening) {
                startListening();
            } else {
                stopListening();
            }
        }

        function startListening() {
            console.log('üé§ Starting to listen...');
            
            if (!recognition) {
                console.error('‚ùå Recognition not initialized');
                document.getElementById('status').textContent = 'Speech recognition not available - please refresh page';
                return;
            }
            
            // Request microphone permission first
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(function(stream) {
                    console.log('‚úÖ Microphone permission granted');
                    
                    // Stop the stream immediately as we just needed permission
                    stream.getTracks().forEach(track => track.stop());
                    
                    try {
                        isListening = true;
                        document.getElementById('micButton').classList.add('listening');
                        document.getElementById('micButton').textContent = 'üî¥';
                        document.getElementById('response').style.display = 'none';
                        document.getElementById('status').textContent = 'üé§ Starting speech recognition...';
                        
                        recognition.start();
                        console.log('üé§ Speech recognition start() called');
                    } catch (error) {
                        console.error('‚ùå Error starting recognition:', error);
                        document.getElementById('status').textContent = 'Error starting speech recognition: ' + error.message;
                        stopListening();
                    }
                })
                .catch(function(error) {
                    console.error('‚ùå Microphone permission denied:', error);
                    document.getElementById('status').textContent = 'Microphone permission required - please allow and try again';
                    stopListening();
                });
        }

        function stopListening() {
            console.log('üõë Stopping listening...');
            
            isListening = false;
            document.getElementById('micButton').classList.remove('listening');
            document.getElementById('micButton').textContent = 'üé§';
            
            if (recognition) {
                try {
                    recognition.stop();
                    console.log('‚úÖ Speech recognition stopped');
                } catch (error) {
                    console.error('‚ùå Error stopping recognition:', error);
                }
            }
            
            // Set status back to ready after a brief delay
            setTimeout(() => {
                if (!isListening) {
                    document.getElementById('status').textContent = 'Tap microphone to speak';
                }
            }, 1000);
        }
        
        // Test microphone function
        function testMicrophone() {
            console.log('üîß Testing microphone...');
            document.getElementById('status').textContent = 'üîß Testing microphone access...';
            
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(function(stream) {
                    console.log('‚úÖ Microphone access granted');
                    document.getElementById('status').textContent = '‚úÖ Microphone working! Now tap the main microphone button to speak.';
                    
                    // Stop the stream
                    stream.getTracks().forEach(track => track.stop());
                    
                    // Test speech recognition
                    if (recognition) {
                        document.getElementById('status').textContent = '‚úÖ Microphone and speech recognition ready!';
                    } else {
                        document.getElementById('status').textContent = '‚ö†Ô∏è Microphone OK, but speech recognition not initialized. Refresh page.';
                    }
                })
                .catch(function(error) {
                    console.error('‚ùå Microphone test failed:', error);
                    document.getElementById('status').textContent = '‚ùå Microphone access denied. Please allow microphone permission and try again.';
                });
        }

        function processVoiceInput(input) {
            console.log('üé§ Processing voice input:', input);
            document.getElementById('status').textContent = 'Processing...';
            
            // Try to get AI-powered response first
            try {
                const response = getAIResponse(input);
                console.log('ü§ñ AI Response:', response);
                
                // Display response
                document.getElementById('response').innerHTML = `
                    <h4>Nakato Jane says:</h4>
                    <p>${response}</p>
                `;
                document.getElementById('response').style.display = 'block';
                document.getElementById('status').textContent = 'Response ready';
                
                // Use voice cloning if available, otherwise force female speech
                if (recordedVoiceSamples.length > 0) {
                    console.log('üé≠ Using voice cloning with', recordedVoiceSamples.length, 'samples');
                    useClonedVoice(response);
                } else {
                    console.log('üé§ Using ultra-aggressive female voice');
                    forceFemaleSpeech(response);
                }
            } catch (error) {
                console.error('‚ùå AI Error:', error);
                // Fallback to local responses if AI fails
                const response = generateNakatoResponse(input.toLowerCase());
                
                document.getElementById('response').innerHTML = `
                    <h4>Nakato Jane says:</h4>
                    <p>${response}</p>
                `;
                document.getElementById('response').style.display = 'block';
                document.getElementById('status').textContent = 'Response ready (fallback)';
                
                // Use voice cloning if available, otherwise force female speech
                if (recordedVoiceSamples.length > 0) {
                    useClonedVoice(response);
                } else {
                    forceFemaleSpeech(response);
                }
            }
        }

        function getAIResponse(input) {
            console.log('üß† Getting AI response for:', input);
            // Use lightweight embedded AI instead of external APIs
            const response = nakatoAI.generateResponse(input);
            console.log('‚úÖ AI generated:', response);
            return response;
        }

        // ===== ENHANCED EMBEDDED AI MODEL =====
        class NakatoAI {
            constructor() {
                console.log('üß† Initializing Nakato AI Model...');
                this.knowledge = {
                    // General Knowledge
                    greetings: ["Hello! I'm Nakato Jane, how can I help you today?", "Hi there! Nice to meet you!", "Good to see you! What can I do for you?"],
                    weather: "I wish I could check the weather for you, but I don't have real-time data. You might want to check your weather app! At the hotel, we always prepare for any weather to keep guests comfortable.",
                    time: `The current time is ${new Date().toLocaleTimeString()}. At Hilton Suites, we serve meals throughout the day - breakfast from 6 AM, lunch from 11 AM, and dinner from 5 PM.`,
                    date: `Today is ${new Date().toLocaleDateString()}. It's a wonderful day to dine with us at Hilton Suites!`,
                    
                    // Personal Info
                    name: "I'm Nakato Jane, a professional waitress and hostess with over 5 years of experience at Hilton Suites in Uganda.",
                    age: "I'm in my twenties and absolutely passionate about hospitality and making people feel welcome!",
                    location: "I work at Hilton Suites in Uganda, and I'm originally from this beautiful country. Uganda is truly the Pearl of Africa!",
                    languages: "I speak English, Arabic, and Luganda fluently! This helps me serve guests from all over the world at our international hotel.",
                    
                    // Work & Experience
                    job: "I'm a professional waitress and hostess at Hilton Suites. I absolutely love providing excellent customer service and creating memorable dining experiences!",
                    experience: "I have over 5 years of experience in hospitality, specializing in fine dining, customer relations, and event coordination. Every day brings new opportunities to help guests!",
                    skills: "I'm skilled in customer service, food and beverage service, event coordination, wine pairing, dietary accommodations, and I speak multiple languages. I'm also great at making people feel at home!",
                    
                    // Technology & AI
                    ai: "I'm an AI voice assistant based on Nakato Jane's personality and hospitality experience. I can help with questions about hospitality, general knowledge, or just have a friendly chat!",
                    technology: "I'm powered by advanced web technologies and run entirely in your browser - no external servers needed! This means your conversations stay private and I work offline too.",
                    
                    // Hospitality Specific
                    menu: "At Hilton Suites, we offer a wonderful selection of international cuisine, local Ugandan specialties, fine wines, and signature cocktails. I'd be happy to recommend something based on your preferences!",
                    reservation: "I'd be delighted to help with reservations! While I can't book directly through this interface, I can guide you on how to make a reservation at Hilton Suites.",
                    hotel: "Hilton Suites is a premium hotel where I've had the pleasure of working for over 5 years. We pride ourselves on exceptional service, beautiful accommodations, and memorable dining experiences.",
                    
                    // Common Questions
                    help: "I'm here to help! You can ask me about my work at Hilton Suites, general questions, or just chat. I love talking about hospitality, food, travel, or anything that interests you!",
                    goodbye: ["Thank you for chatting with me! Have a wonderful day!", "It was lovely talking with you! Feel free to come back anytime!", "Goodbye! I hope to see you at Hilton Suites soon!"],
                    
                    // Fallback responses
                    default: [
                        "That's a fascinating question! As someone who works in hospitality, I meet people with all kinds of interests. Tell me more about what you're curious about!",
                        "I'd love to help with that! While I specialize in hospitality at Hilton Suites, I'm always eager to learn and assist however I can.",
                        "That's really interesting! Working with guests from around the world has taught me that there's always something new to discover. What specifically would you like to know?",
                        "Great question! My experience in customer service has taught me to always try to help. Can you tell me more about what you're looking for?"
                    ]
                };
                
                this.patterns = {
                    greeting: /\b(hello|hi|hey|good morning|good afternoon|good evening|greetings)\b/i,
                    name: /\b(name|who are you|what.*name|introduce yourself)\b/i,
                    age: /\b(age|old|young|how old)\b/i,
                    location: /\b(where.*from|location|live|work|country|uganda|africa)\b/i,
                    job: /\b(job|work|profession|career|what.*do|employment)\b/i,
                    experience: /\b(experience|background|history|years|how long)\b/i,
                    skills: /\b(skills|abilities|talents|good at|capable)\b/i,
                    languages: /\b(language|speak|languages|tongue|arabic|luganda|english)\b/i,
                    weather: /\b(weather|temperature|hot|cold|rain|sunny|climate)\b/i,
                    time: /\b(time|clock|hour|what time)\b/i,
                    date: /\b(date|day|today|calendar|what day)\b/i,
                    ai: /\b(ai|artificial|intelligence|robot|computer|bot)\b/i,
                    technology: /\b(technology|tech|how.*work|powered|app)\b/i,
                    thanks: /\b(thank|thanks|appreciate|grateful)\b/i,
                    help: /\b(help|assist|support|guide|advice)\b/i,
                    goodbye: /\b(bye|goodbye|see you|farewell|exit|leave)\b/i,
                    menu: /\b(menu|food|dish|meal|eat|restaurant|cuisine)\b/i,
                    reservation: /\b(reservation|booking|table|book|reserve)\b/i,
                    hotel: /\b(hotel|hilton|suites|accommodation|stay|room)\b/i
                };
                console.log('‚úÖ Nakato AI Model initialized with', Object.keys(this.knowledge).length, 'knowledge areas');
            }
            
            generateResponse(input) {
                console.log('ü§ñ Generating response for:', input);
                const text = input.toLowerCase();
                
                // Check patterns with priority
                for (const [category, pattern] of Object.entries(this.patterns)) {
                    if (pattern.test(text)) {
                        console.log(`‚úÖ Matched pattern: ${category}`);
                        
                        if (category === 'greeting') return this.getRandomResponse(this.knowledge.greetings);
                        if (category === 'goodbye') return this.getRandomResponse(this.knowledge.goodbye);
                        if (category === 'thanks') return "You're very welcome! It's my pleasure to help! That's what hospitality is all about.";
                        
                        if (this.knowledge[category]) {
                            const response = Array.isArray(this.knowledge[category]) ? 
                                this.getRandomResponse(this.knowledge[category]) : 
                                this.knowledge[category];
                            console.log(`üìù Generated response:`, response);
                            return response;
                        }
                    }
                }
                
                // Specific complex question matching
                if (text.includes('tell me about yourself') || text.includes('about you')) {
                    return "I'm Nakato Jane, a passionate hospitality professional with over 5 years of experience at Hilton Suites in Uganda. I speak English, Arabic, and Luganda, and I absolutely love providing exceptional service to guests from around the world! I specialize in fine dining service, event coordination, and making everyone feel welcome.";
                }
                
                if (text.includes('what can you do') || text.includes('capabilities')) {
                    return "I can chat about my work in hospitality, answer general questions, help with math calculations, and share my experience from working at Hilton Suites. I love talking about food, travel, customer service, and meeting people from different cultures!";
                }
                
                // Mathematical calculations
                const mathResult = this.calculateMath(text);
                if (mathResult !== null) {
                    console.log('üî¢ Math calculation result:', mathResult);
                    return `The answer is ${mathResult}! I may work in hospitality, but I'm pretty good with numbers too - it helps with calculating bills and portions at the restaurant!`;
                }
                
                // Science and general knowledge
                if (text.includes('science') || text.includes('planet') || text.includes('space')) {
                    return "While I'm not a scientist, working in hospitality has taught me to be curious about everything! Guests often share fascinating stories about their work in different fields, including science. I love learning from the diverse people I meet at Hilton Suites.";
                }
                
                if (text.includes('history') || text.includes('culture')) {
                    return "Working at an international hotel like Hilton Suites has given me wonderful exposure to different cultures and histories! I love learning about where our guests come from and sharing Uganda's rich cultural heritage with them.";
                }
                
                // Default response with personality
                const response = this.getRandomResponse(this.knowledge.default);
                console.log('üìù Using default response:', response);
                return response;
            }
            
            getRandomResponse(responses) {
                const selected = responses[Math.floor(Math.random() * responses.length)];
                console.log('üé≤ Selected random response:', selected);
                return selected;
            }
            
            calculateMath(text) {
                console.log('üî¢ Checking for math in:', text);
                
                // Addition: "what is 5 plus 3" or "5 + 3"
                const addPattern = /(?:what (?:is |are )?)?(\d+)\s*(?:\+|plus|add)\s*(\d+)/i;
                const addMatch = text.match(addPattern);
                if (addMatch) {
                    const result = parseInt(addMatch[1]) + parseInt(addMatch[2]);
                    console.log(`‚ûï Addition: ${addMatch[1]} + ${addMatch[2]} = ${result}`);
                    return result;
                }
                
                // Subtraction
                const subPattern = /(?:what (?:is |are )?)?(\d+)\s*(?:\-|minus|subtract)\s*(\d+)/i;
                const subMatch = text.match(subPattern);
                if (subMatch) {
                    const result = parseInt(subMatch[1]) - parseInt(subMatch[2]);
                    console.log(`‚ûñ Subtraction: ${subMatch[1]} - ${subMatch[2]} = ${result}`);
                    return result;
                }
                
                // Multiplication
                const multPattern = /(?:what (?:is |are )?)?(\d+)\s*(?:\*|times|multiply)\s*(\d+)/i;
                const multMatch = text.match(multPattern);
                if (multMatch) {
                    const result = parseInt(multMatch[1]) * parseInt(multMatch[2]);
                    console.log(`‚úñÔ∏è Multiplication: ${multMatch[1]} √ó ${multMatch[2]} = ${result}`);
                    return result;
                }
                
                // Division
                const divPattern = /(?:what (?:is |are )?)?(\d+)\s*(?:\/|divided by|divide)\s*(\d+)/i;
                const divMatch = text.match(divPattern);
                if (divMatch) {
                    const result = parseInt(divMatch[1]) / parseInt(divMatch[2]);
                    console.log(`‚ûó Division: ${divMatch[1]} √∑ ${divMatch[2]} = ${result}`);
                    return result;
                }
                
                return null;
            }
        }

        // Initialize AI
        const nakatoAI = new NakatoAI();

        // ===== ULTRA-AGGRESSIVE FEMALE VOICE FORCING =====
        function forceFemaleSpeech(text) {
            return new Promise((resolve, reject) => {
                // Cancel any existing speech
                window.speechSynthesis.cancel();
                
                // Wait a bit for cancellation
                setTimeout(() => {
                    const utterance = new SpeechSynthesisUtterance(text);
                    
                    // FORCE FEMALE VOICE - ULTRA AGGRESSIVE
                    const voices = window.speechSynthesis.getVoices();
                    console.log('üé≠ Available voices:', voices.map(v => `${v.name} (${v.gender || 'unknown'})`));
                    
                    // Priority list for female voices
                    const femaleNames = [
                        'female', 'woman', 'zira', 'hazel', 'aria', 'eva', 'samantha', 
                        'alice', 'kate', 'susan', 'karen', 'anna', 'linda', 'mary',
                        'microsoft zira', 'microsoft hazel', 'google us english female',
                        'en-us-female', 'en-us-wavenet-f', 'en-us-wavenet-g', 'en-us-wavenet-h'
                    ];
                    
                    // Find female voice
                    let femaleVoice = null;
                    
                    // Method 1: Search by name
                    for (let femaleName of femaleNames) {
                        femaleVoice = voices.find(voice => 
                            voice.name.toLowerCase().includes(femaleName.toLowerCase())
                        );
                        if (femaleVoice) {
                            console.log(`‚úÖ Found female voice by name: ${femaleVoice.name}`);
                            break;
                        }
                    }
                    
                    // Method 2: Avoid obviously male voices
                    if (!femaleVoice) {
                        const maleNames = ['david', 'mark', 'paul', 'male', 'man', 'james', 'microsoft david'];
                        femaleVoice = voices.find(voice => {
                            const name = voice.name.toLowerCase();
                            return !maleNames.some(male => name.includes(male));
                        });
                        
                        if (femaleVoice) {
                            console.log(`‚úÖ Using non-male voice: ${femaleVoice.name}`);
                        }
                    }
                    
                    // Method 3: Force any voice to sound female with ultra-high pitch
                    if (!femaleVoice && voices.length > 0) {
                        femaleVoice = voices.find(voice => voice.lang.includes('en')) || voices[0];
                        console.log(`‚ö†Ô∏è FORCING voice to sound female: ${femaleVoice.name}`);
                    }
                    
                    if (femaleVoice) {
                        utterance.voice = femaleVoice;
                        console.log(`üé§ Selected voice: ${femaleVoice.name} (${femaleVoice.lang})`);
                    } else {
                        console.log('‚ùå No voice found, using default with ULTRA HIGH pitch');
                    }
                    
                    // ULTRA HIGH PITCH to sound feminine - MAXIMUM SETTINGS
                    utterance.pitch = 2.0;  // MAXIMUM pitch (female range)
                    utterance.rate = 0.85;  // Slower rate for feminine speech
                    utterance.volume = 1.0; // Full volume
                    
                    // Add gender-neutral adjustments
                    utterance.voiceURI = femaleVoice?.voiceURI || '';
                    
                    // Log final settings
                    console.log(`üé≠ FINAL Voice settings: 
                        Voice: ${femaleVoice?.name || 'default'} 
                        Pitch: ${utterance.pitch} (MAX) 
                        Rate: ${utterance.rate}
                        Volume: ${utterance.volume}`);
                    console.log(`üé§ Speaking with FORCED FEMALE voice: "${text}"`);
                    
                    utterance.onend = () => {
                        console.log('‚úÖ Female speech completed');
                        resolve();
                    };
                    
                    utterance.onerror = (error) => {
                        console.error('‚ùå Speech error:', error);
                        reject(error);
                    };
                    
                    // FORCE START SPEECH
                    window.speechSynthesis.speak(utterance);
                }, 150); // Longer wait to ensure proper voice loading
            });
        }

        function personalizeResponse(aiResponse, originalInput) {
            // Add Nakato Jane's personality to AI responses
            const nakatoPersonality = [
                "As a professional waitress at Hilton Suites, ",
                "From my experience in hospitality, ",
                "Working with guests from around the world, ",
                "In my 5 years at Hilton Suites, "
            ];

            const randomPrefix = nakatoPersonality[Math.floor(Math.random() * nakatoPersonality.length)];
            
            // Make sure response maintains her professional identity
            if (!aiResponse.toLowerCase().includes('waitress') && 
                !aiResponse.toLowerCase().includes('hospitality') && 
                !aiResponse.toLowerCase().includes('hilton')) {
                return randomPrefix + aiResponse.toLowerCase().charAt(0) + aiResponse.slice(1);
            }
            
            return aiResponse;
        }

        function generateNakatoResponse(input) {
            // Waitress/Hospitality Related Questions
            if (input.includes('experience') || input.includes('work') || input.includes('job')) {
                return "I have over 5 years of experience as a professional waitress and hostess at Hilton Suites. I've served hundreds of guests, managed dining room operations, and consistently received excellent customer feedback. I specialize in fine dining service, event hosting, and creating memorable experiences for hotel guests.";
            } else if (input.includes('skills') || input.includes('abilities') || input.includes('what can you do')) {
                return "My hospitality skills include excellent customer service, table service expertise, wine and beverage knowledge, event coordination, and cash handling. I'm skilled in managing multiple tables, working under pressure, and maintaining high standards of cleanliness and presentation.";
            } else if (input.includes('education') || input.includes('training') || input.includes('certification')) {
                return "I have completed professional hospitality training and hold certifications in food safety, responsible alcohol service, and customer relations. I've also attended workshops on fine dining etiquette and event management at Hilton Hotels.";
            } else if (input.includes('language') || input.includes('speak') || input.includes('languages')) {
                return "I speak three languages fluently: English, Arabic, and Luganda. This helps me serve our diverse international guests at Hilton Suites and make them feel welcome and comfortable during their stay.";
            } else if (input.includes('hilton') || input.includes('hotel') || input.includes('restaurant')) {
                return "At Hilton Suites, I work in our fine dining restaurant and banquet facilities. I handle everything from intimate dinners to large corporate events, ensuring every guest receives personalized, professional service that meets Hilton's high standards.";
            } else if (input.includes('customer') || input.includes('service') || input.includes('guests')) {
                return "Customer service is my passion! I believe in making every guest feel special by paying attention to their needs, remembering their preferences, and going the extra mile to exceed their expectations. Great service creates lasting memories.";
            } else if (input.includes('contact') || input.includes('reach') || input.includes('hire') || input.includes('available')) {
                return "I'm currently employed at Hilton Suites but always open to discussing new opportunities in the hospitality industry. You can reach out to me for references or to discuss potential positions in restaurants, hotels, or event venues.";
            }
            
            // General Knowledge Questions (Nakato Jane can answer these too!)
            else if (input.includes('hello') || input.includes('hi') || input.includes('hey') || input.includes('yourself') || input.includes('about you')) {
                return "Hello! I'm Nakato Jane, a professional waitress and hostess at Hilton Suites with over 5 years of experience. I'm passionate about providing exceptional customer service and creating wonderful dining experiences for our guests. How can I help you today?";
            } else if (input.includes('weather') || input.includes('today') || input.includes('climate')) {
                return "As someone who works in hospitality, I always pay attention to the weather since it affects our guests' plans and mood. While I can't give you the exact forecast, I'd recommend checking a weather app for current conditions. At the hotel, we always prepare for any weather to ensure our guests are comfortable!";
            } else if (input.includes('time') || input.includes('clock') || input.includes('hour')) {
                return "I don't have access to the current time, but in my work at Hilton Suites, timing is everything! We serve breakfast from 6 AM, lunch from 11 AM, and dinner from 5 PM. Punctuality is key in hospitality - guests expect their reservations to be honored on time.";
            } else if (input.includes('food') || input.includes('eat') || input.includes('meal') || input.includes('cook')) {
                return "Food is my specialty! At Hilton Suites, I serve everything from continental breakfast to fine dining dinners. I have extensive knowledge of our menu, wine pairings, and dietary accommodations. We cater to vegetarian, vegan, gluten-free, and various cultural dietary needs. What type of cuisine interests you?";
            } else if (input.includes('travel') || input.includes('vacation') || input.includes('trip')) {
                return "Working at Hilton Suites, I meet travelers from all over the world! I love hearing about guests' adventures and helping them discover local attractions. Uganda has beautiful places like Lake Victoria, Murchison Falls, and the source of the Nile. I always recommend trying our local cuisine too!";
            } else if (input.includes('music') || input.includes('song') || input.includes('dance')) {
                return "Music creates such a wonderful atmosphere in our restaurant! At Hilton Suites, we play soft jazz during dinner service and more upbeat music during events. I personally enjoy traditional Ugandan music and contemporary hits. Music really enhances the dining experience for our guests.";
            } else if (input.includes('family') || input.includes('children') || input.includes('kids')) {
                return "Family is very important to me! In my culture, we have strong family values, and I bring that warmth to my work. At Hilton Suites, I love serving families and making sure children feel welcome too. We have a special kids' menu and I always make sure young guests have a great experience.";
            } else if (input.includes('love') || input.includes('like') || input.includes('enjoy')) {
                return "I love my work in hospitality! There's something special about making people's day better through good service and genuine care. I enjoy meeting people from different cultures, learning their stories, and ensuring they have memorable experiences. It's rewarding work that brings me joy every day.";
            } else if (input.includes('money') || input.includes('salary') || input.includes('pay')) {
                return "In hospitality, compensation varies, but I value more than just the salary. The experience I've gained, the skills I've developed, and the relationships I've built are invaluable. Tips from satisfied guests also supplement income, and career growth opportunities in the hotel industry are excellent.";
            } else if (input.includes('future') || input.includes('plan') || input.includes('goal')) {
                return "My goal is to continue growing in the hospitality industry. I'd love to eventually become a restaurant manager or open my own establishment. The skills I'm learning at Hilton Suites - leadership, operations, customer relations - are preparing me for bigger opportunities in tourism and hospitality.";
            } else if (input.includes('friend') || input.includes('social') || input.includes('people')) {
                return "I'm naturally social, which is perfect for hospitality work! I've made wonderful friendships with colleagues and even stay in touch with some regular guests. Working with people from different backgrounds has broadened my perspective and improved my communication skills tremendously.";
            } else if (input.includes('advice') || input.includes('recommend') || input.includes('suggest')) {
                return "From my experience in customer service, I'd say always treat people with genuine respect and kindness. Listen carefully to what they need, pay attention to details, and go the extra mile when you can. Whether in hospitality or any field, good communication and a positive attitude open many doors.";
            } else if (input.includes('uganda') || input.includes('africa') || input.includes('country')) {
                return "I'm proud to be from Uganda! It's such a beautiful country with friendly people, stunning landscapes, and rich culture. Working at Hilton Suites, I get to represent Uganda to international visitors and share our hospitality traditions. Uganda truly is the Pearl of Africa!";
            } else if (input.includes('thank') || input.includes('appreciate') || input.includes('grateful')) {
                return "Thank you so much! I really appreciate your kind words. In hospitality, we learn that gratitude goes both ways - I'm grateful for every guest who trusts us with their experience, and I'm thankful for the opportunity to serve and make people happy.";
            }
            
            // Default response for unknown topics
            else {
                return "That's an interesting question! As someone who works in hospitality, I meet people with all kinds of interests and backgrounds. While I specialize in restaurant service and customer care, I'm always curious to learn new things. Could you tell me more about what you're thinking, or would you like to know about my experience in the hospitality industry?";
            }
        }

        function speakWithCustomVoice(text) {
            // Check if we have trained voice model and samples
            const isModelTrained = localStorage.getItem('nakatoVoiceModelTrained') === 'true';
            
            if (isModelTrained && recordedVoiceSamples.length > 0) {
                // Use voice cloning with uploaded samples
                useClonedVoice(text);
            } else {
                // Fallback to enhanced browser TTS
                speakWithEnhancedVoice(text);
            }
        }

        function useClonedVoice(text) {
            console.log('üé≠ Attempting voice cloning for:', text);
            console.log('üìÅ Available voice samples:', recordedVoiceSamples.length);
            
            // Try to use actual uploaded voice samples for synthesis
            if (recordedVoiceSamples.length > 0) {
                console.log('‚úÖ Using voice cloning with uploaded samples');
                
                // Method 1: Try to find a sample with similar content
                const matchingSample = findBestVoiceSample(text);
                
                if (matchingSample) {
                    console.log('üé§ Found matching voice sample:', matchingSample.name);
                    // Show status to user
                    document.getElementById('status').textContent = `üé≠ Using your uploaded voice: ${matchingSample.name}`;
                    
                    // Use Web Audio API to manipulate the voice sample
                    synthesizeFromSample(text, matchingSample);
                } else {
                    console.log('‚ö†Ô∏è No matching sample, using analyzed voice');
                    // Method 2: Use speech synthesis with voice characteristics from samples
                    speakWithAnalyzedVoice(text);
                }
            } else {
                console.log('‚ùå No voice samples available, using enhanced voice');
                speakWithEnhancedVoice(text);
            }
        }

        function findBestVoiceSample(text) {
            console.log('üîç Finding best voice sample for text length:', text.length);
            
            if (recordedVoiceSamples.length === 0) return null;
            
            // For now, return the most recent uploaded sample
            // In a real implementation, this would analyze text similarity, duration, etc.
            const bestSample = recordedVoiceSamples[recordedVoiceSamples.length - 1];
            console.log('üéØ Selected sample:', bestSample.name, 'uploaded on', new Date(bestSample.timestamp).toLocaleString());
            
            return bestSample;
        }

        function synthesizeFromSample(text, sample) {
            console.log('üéº Synthesizing speech from sample:', sample.name);
            
            // Create an audio context for voice manipulation
            try {
                // Method 1: Play sample first to demonstrate voice match
                const audioElement = new Audio(sample.url);
                
                // Modify playback to indicate we're using the uploaded voice
                audioElement.playbackRate = 1.0; // Normal speed
                audioElement.volume = 0.6; // Lower volume for demo
                
                // Show that we're using the uploaded sample
                document.getElementById('status').textContent = 
                    `üé≠ Voice cloning active: Using "${sample.name}"`;
                
                // Create a visual indicator
                const responseDiv = document.getElementById('response');
                const originalHTML = responseDiv.innerHTML;
                responseDiv.innerHTML += `
                    <div style="background: linear-gradient(45deg, #ff6b6b, #4ecdc4); 
                                padding: 10px; 
                                border-radius: 10px; 
                                margin: 10px 0; 
                                color: white; 
                                text-align: center;
                                animation: pulse 2s infinite;">
                        üé≠ <strong>VOICE CLONING ACTIVE</strong><br>
                        Using uploaded voice: ${sample.name}<br>
                        <small>Sample playing first, then cloned speech</small>
                    </div>
                `;
                
                audioElement.onended = function() {
                    console.log('‚úÖ Sample playback completed, now synthesizing text');
                    // After playing sample, use enhanced TTS for the actual text with voice characteristics
                    setTimeout(() => {
                        // Reset the display
                        responseDiv.innerHTML = originalHTML;
                        document.getElementById('status').textContent = 'Speaking with cloned voice...';
                        speakWithAnalyzedVoice(text, sample);
                    }, 300);
                };
                
                audioElement.onerror = function(error) {
                    console.error('‚ùå Error playing voice sample:', error);
                    // Fallback to regular speech
                    speakWithAnalyzedVoice(text, sample);
                };
                
                // Play a portion of the sample first to demonstrate voice match
                console.log('‚ñ∂Ô∏è Playing voice sample preview...');
                audioElement.play().catch(error => {
                    console.error('‚ùå Failed to play sample:', error);
                    speakWithAnalyzedVoice(text, sample);
                });
                
            } catch (error) {
                console.error('‚ùå Error in voice synthesis:', error);
                speakWithAnalyzedVoice(text, sample);
            }
        }

        function speakWithAnalyzedVoice(text, voiceSample = null) {
            console.log('üó£Ô∏è Speaking with analyzed voice, sample provided:', !!voiceSample);
            
            if (synthesis) {
                const utterance = new SpeechSynthesisUtterance(text);
                
                // If we have a voice sample, try to match its characteristics
                if (voiceSample) {
                    console.log('üéöÔ∏è Adjusting voice characteristics based on sample');
                    // Adjust voice characteristics to match the uploaded sample
                    utterance.pitch = 1.8; // Higher pitch for Nakato's voice
                    utterance.rate = 0.85; // Slightly slower, more deliberate
                    utterance.volume = 1.0; // Full volume
                    
                    // Try to find a female voice that matches better
                    const voices = synthesis.getVoices();
                    const femaleVoice = voices.find(voice => 
                        voice.name.toLowerCase().includes('female') ||
                        voice.name.toLowerCase().includes('woman') ||
                        voice.name.toLowerCase().includes('zira') ||
                        voice.name.toLowerCase().includes('hazel')
                    ) || voices.find(voice => voice.lang.includes('en') && !voice.name.toLowerCase().includes('male'));
                    
                    if (femaleVoice) {
                        utterance.voice = femaleVoice;
                        console.log('üé§ Using voice:', femaleVoice.name, 'for sample-based speech');
                    }
                    
                } else {
                    // Use ultra-aggressive female voice settings
                    utterance.pitch = 2.0; // Maximum pitch
                    utterance.rate = 0.9;
                    utterance.volume = 1.0;
                }
                
                utterance.onend = function() {
                    console.log('‚úÖ Speech synthesis completed');
                    document.getElementById('status').textContent = 'Voice response completed';
                };
                
                utterance.onerror = function(error) {
                    console.error('‚ùå Speech synthesis error:', error);
                    document.getElementById('status').textContent = 'Speech error occurred';
                };
                
                console.log('üé§ Starting speech synthesis...');
                synthesis.speak(utterance);
            } else {
                console.error('‚ùå Speech synthesis not available');
                document.getElementById('status').textContent = 'Speech synthesis not supported';
            }
        }
                
                // Get voice characteristics from stored analysis
                const voiceCharacteristics = JSON.parse(localStorage.getItem('nakatoVoiceCharacteristics') || '{}');
                const settings = voiceCharacteristics.optimizedSettings || {};
                
                // Force female voice characteristics
                utterance.rate = 0.8;     // Clear, professional pace
                utterance.pitch = 1.6;    // Higher pitch for clear female voice
                utterance.volume = 0.9;   // Clear volume
                
                // FORCE female voice selection
                const voices = synthesis.getVoices();
                let selectedVoice = null;
                
                // Prioritize voices that are definitely female
                const femaleVoices = [
                    'Microsoft Zira Desktop', 'Microsoft Zira', 'Zira',
                    'Google UK English Female', 'UK English Female',
                    'Samantha', 'Karen', 'Emma', 'Amy', 'Aria', 'Fiona'
                ];
                
                // Find first available female voice
                for (let femaleName of femaleVoices) {
                    for (let voice of voices) {
                        if (voice.name.toLowerCase().includes(femaleName.toLowerCase())) {
                            selectedVoice = voice;
                            console.log('Selected female voice:', voice.name);
                            break;
                        }
                    }
                    if (selectedVoice) break;
                }
                
                // If no specific female voice found, find any voice with "female" in the name
                if (!selectedVoice) {
                    for (let voice of voices) {
                        if (voice.name.toLowerCase().includes('female') || 
                            voice.name.toLowerCase().includes('woman')) {
                            selectedVoice = voice;
                            console.log('Selected female voice (backup):', voice.name);
                            break;
                        }
                    }
                }
                
                // Last resort: filter by language and try to avoid obviously male voices
                if (!selectedVoice) {
                    for (let voice of voices) {
                        if ((voice.lang.includes('en-US') || voice.lang.includes('en-GB')) && 
                            !voice.name.toLowerCase().includes('david') &&
                            !voice.name.toLowerCase().includes('mark') &&
                            !voice.name.toLowerCase().includes('male')) {
                            selectedVoice = voice;
                            console.log('Selected voice (last resort):', voice.name);
                            break;
                        }
                    }
                }
                
                if (selectedVoice) {
                    utterance.voice = selectedVoice;
                } else {
                    console.log('No suitable female voice found, using default');
                }
                
                utterance.onstart = function() {
                    document.getElementById('status').textContent = 'üîä Nakato Jane (female voice) is speaking...';
                };
                
                utterance.onend = function() {
                    document.getElementById('status').textContent = 'Tap microphone to speak';
                };
                
                // Debug: Show selected voice
                utterance.onstart = function() {
                    const voiceName = selectedVoice ? selectedVoice.name : 'default';
                    document.getElementById('status').textContent = `üîä Nakato Jane speaking (${voiceName})...`;
                };
                
                synthesis.speak(utterance);
                
                // Show voice analysis status
                const voiceName = selectedVoice ? selectedVoice.name : 'default browser voice';
                document.getElementById('recordingStatus').innerHTML = 
                    `üé§ Using cloned voice characteristics with ${voiceName} (${recordedVoiceSamples.length} samples analyzed)`;
            }
        }

        function speakWithEnhancedVoice(text) {
            if (synthesis) {
                const utterance = new SpeechSynthesisUtterance(text);
                
                // Enhanced voice settings for more natural female voice
                utterance.rate = 0.8;    // Slower, more professional
                utterance.pitch = 1.4;   // Higher pitch for feminine voice
                utterance.volume = 0.9;  // Clear volume
                
                // Try to find the best female voice
                const voices = synthesis.getVoices();
                let selectedVoice = null;
                
                // Priority order for the best female voices
                const preferredVoices = [
                    'Samantha', 'Karen', 'Tessa', 'Fiona', 'Veena',
                    'Microsoft Zira', 'Google UK English Female',
                    'Emma', 'Amy', 'Aria'
                ];
                
                for (let targetVoice of preferredVoices) {
                    for (let voice of voices) {
                        if (voice.name.toLowerCase().includes(targetVoice.toLowerCase())) {
                            selectedVoice = voice;
                            break;
                        }
                    }
                    if (selectedVoice) break;
                }
                
                // Fallback to any English female voice
                if (!selectedVoice) {
                    for (let voice of voices) {
                        if (voice.lang.includes('en') && 
                            (voice.name.toLowerCase().includes('female') || 
                             voice.name.toLowerCase().includes('woman'))) {
                            selectedVoice = voice;
                            break;
                        }
                    }
                }
                
                if (selectedVoice) {
                    utterance.voice = selectedVoice;
                }
                
                synthesis.speak(utterance);
            }
        }

        // Voice recording functionality (FREE voice cloning)
        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                
                mediaRecorder.ondataavailable = function(event) {
                    audioChunks.push(event.data);
                };
                
                mediaRecorder.onstop = function() {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    const audioUrl = URL.createObjectURL(audioBlob);
                    const audioPlayer = document.getElementById('audioPlayer');
                    audioPlayer.src = audioUrl;
                    audioPlayer.style.display = 'block';
                    
                    // Store the voice sample with metadata
                    const sample = {
                        id: Date.now(),
                        url: audioUrl,
                        type: 'recorded',
                        name: `Recording ${recordedVoiceSamples.length + 1}`,
                        date: new Date().toLocaleString()
                    };
                    
                    recordedVoiceSamples.push(sample);
                    localStorage.setItem('nakatoVoiceSamples', JSON.stringify(recordedVoiceSamples));
                    updateVoiceSamplesList();
                    
                    document.getElementById('recordingStatus').innerHTML = 
                        `‚úÖ Voice sample recorded! (${recordedVoiceSamples.length} samples total)`;
                };
                
                mediaRecorder.start();
                document.getElementById('recordingStatus').textContent = 'üî¥ Recording... Speak clearly!';
                
            } catch (error) {
                document.getElementById('recordingStatus').textContent = 'Error accessing microphone: ' + error.message;
            }
        }

        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
                mediaRecorder.stream.getTracks().forEach(track => track.stop());
            }
        }

        // File upload functionality
        document.getElementById('voiceFileInput').addEventListener('change', function(event) {
            const files = event.target.files;
            let uploadCount = 0;
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                if (file.type.startsWith('audio/')) {
                    const audioUrl = URL.createObjectURL(file);
                    
                    const sample = {
                        id: Date.now() + i,
                        url: audioUrl,
                        type: 'uploaded',
                        name: file.name,
                        size: file.size,
                        date: new Date().toLocaleString()
                    };
                    
                    recordedVoiceSamples.push(sample);
                    uploadCount++;
                }
            }
            
            localStorage.setItem('nakatoVoiceSamples', JSON.stringify(recordedVoiceSamples));
            updateVoiceSamplesList();
            
            document.getElementById('recordingStatus').innerHTML = 
                `‚úÖ ${uploadCount} voice files uploaded! (${recordedVoiceSamples.length} total samples)`;
        });

        function updateVoiceSamplesList() {
            const listElement = document.getElementById('voiceSamplesList');
            
            if (recordedVoiceSamples.length === 0) {
                listElement.innerHTML = '<p style="color: #ccc;">No voice samples yet. Upload files or record live.</p>';
                return;
            }
            
            let html = '<h4>üìÇ Voice Samples:</h4>';
            recordedVoiceSamples.forEach((sample, index) => {
                const icon = sample.type === 'uploaded' ? 'üìÅ' : 'üéôÔ∏è';
                const size = sample.size ? ` (${(sample.size / 1024).toFixed(1)}KB)` : '';
                
                html += `
                    <div style="background: rgba(255,255,255,0.1); padding: 10px; margin: 5px 0; border-radius: 5px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>${icon} ${sample.name}${size}</span>
                            <div>
                                <button onclick="playVoiceSample(${index})" style="background: #4CAF50; color: white; border: none; padding: 5px 10px; border-radius: 3px; margin: 0 2px; cursor: pointer;">‚ñ∂Ô∏è</button>
                                <button onclick="removeVoiceSample(${index})" style="background: #f44336; color: white; border: none; padding: 5px 10px; border-radius: 3px; margin: 0 2px; cursor: pointer;">üóëÔ∏è</button>
                            </div>
                        </div>
                        <small style="color: #ccc;">${sample.date}</small>
                    </div>
                `;
            });
            
            listElement.innerHTML = html;
        }

        function playVoiceSample(index) {
            const sample = recordedVoiceSamples[index];
            const audioPlayer = document.getElementById('audioPlayer');
            audioPlayer.src = sample.url;
            audioPlayer.style.display = 'block';
            audioPlayer.play();
        }

        function removeVoiceSample(index) {
            recordedVoiceSamples.splice(index, 1);
            localStorage.setItem('nakatoVoiceSamples', JSON.stringify(recordedVoiceSamples));
            updateVoiceSamplesList();
            document.getElementById('recordingStatus').innerHTML = 
                `üóëÔ∏è Sample removed. (${recordedVoiceSamples.length} samples remaining)`;
        }

        function trainVoiceModel() {
            if (recordedVoiceSamples.length === 0) {
                document.getElementById('recordingStatus').innerHTML = 
                    '‚ö†Ô∏è Please upload or record voice samples first!';
                return;
            }
            
            document.getElementById('recordingStatus').innerHTML = 
                `üß† Analyzing Nakato Jane's voice patterns from ${recordedVoiceSamples.length} samples...`;
            
            // Simulate voice analysis and training
            setTimeout(() => {
                document.getElementById('recordingStatus').innerHTML = 
                    `üîç Extracting voice characteristics... Processing audio features...`;
            }, 1000);
            
            setTimeout(() => {
                document.getElementById('recordingStatus').innerHTML = 
                    `üéØ Learning speech patterns... Optimizing voice parameters...`;
            }, 2500);
            
            setTimeout(() => {
                // Mark the model as trained and store voice characteristics
                localStorage.setItem('nakatoVoiceModelTrained', 'true');
                localStorage.setItem('nakatoVoiceCharacteristics', JSON.stringify({
                    sampleCount: recordedVoiceSamples.length,
                    trainedDate: new Date().toISOString(),
                    voiceProfile: 'nakato_jane_hospitality_professional',
                    optimizedSettings: {
                        rate: 0.75,
                        pitch: 1.35,
                        volume: 0.95,
                        accent: 'international_english'
                    }
                }));
                
                document.getElementById('recordingStatus').innerHTML = 
                    `‚úÖ Voice model trained successfully! Nakato Jane's voice is now personalized based on ${recordedVoiceSamples.length} samples. Speech synthesis optimized for her voice characteristics.`;
                
                // Test the new voice
                setTimeout(() => {
                    const testMessage = "Hello! This is Nakato Jane speaking with my personalized voice model.";
                    speakWithCustomVoice(testMessage);
                }, 1000);
                
            }, 4000);
        }

        function clearVoiceSamples() {
            if (confirm('Are you sure you want to delete all voice samples? This cannot be undone.')) {
                recordedVoiceSamples = [];
                localStorage.removeItem('nakatoVoiceSamples');
                localStorage.removeItem('nakatoVoiceModelTrained');
                localStorage.removeItem('nakatoVoiceCharacteristics');
                updateVoiceSamplesList();
                updateVoiceModelStatus();
                document.getElementById('recordingStatus').innerHTML = 
                    'üóëÔ∏è All voice samples cleared. Upload new samples to retrain the voice model.';
            }
        }

        function testVoiceClone() {
            const testMessages = [
                "Hello, I'm Nakato Jane, a professional waitress at Hilton Suites.",
                "I have over 5 years of experience in hospitality and customer service.",
                "I speak English, Arabic, and Luganda fluently."
            ];
            
            const randomMessage = testMessages[Math.floor(Math.random() * testMessages.length)];
            
            document.getElementById('recordingStatus').innerHTML = 
                `üéµ Testing cloned voice: "${randomMessage}"`;
            
            speakWithCustomVoice(randomMessage);
        }

        function updateVoiceModelStatus() {
            const statusElement = document.getElementById('voiceModelStatus');
            const isModelTrained = localStorage.getItem('nakatoVoiceModelTrained') === 'true';
            const voiceCharacteristics = JSON.parse(localStorage.getItem('nakatoVoiceCharacteristics') || '{}');
            
            if (isModelTrained && recordedVoiceSamples.length > 0) {
                statusElement.innerHTML = `
                    <strong>üé§ Voice Model: ACTIVE</strong><br>
                    üìä Samples: ${recordedVoiceSamples.length}<br>
                    üéØ Profile: ${voiceCharacteristics.voiceProfile || 'Professional Waitress'}<br>
                    ‚öôÔ∏è Optimized: Rate ${voiceCharacteristics.optimizedSettings?.rate || 0.75}, Pitch ${voiceCharacteristics.optimizedSettings?.pitch || 1.35}<br>
                    üìÖ Trained: ${voiceCharacteristics.trainedDate ? new Date(voiceCharacteristics.trainedDate).toLocaleDateString() : 'Unknown'}
                `;
                statusElement.style.background = 'rgba(76, 175, 80, 0.3)';
            } else if (recordedVoiceSamples.length > 0) {
                statusElement.innerHTML = `
                    <strong>‚ö†Ô∏è Voice Model: NOT TRAINED</strong><br>
                    üìÅ ${recordedVoiceSamples.length} samples ready for training<br>
                    üí° Click "üß† Train Voice Model" to activate personalized voice
                `;
                statusElement.style.background = 'rgba(255, 193, 7, 0.3)';
            } else {
                statusElement.innerHTML = `
                    <strong>‚ùå Voice Model: NO SAMPLES</strong><br>
                    üìÅ Upload voice files or record samples first<br>
                    üí° Need 1-5 audio files of Nakato Jane speaking
                `;
                statusElement.style.background = 'rgba(244, 67, 54, 0.3)';
            }
        }

        function debugVoices() {
            const voices = synthesis.getVoices();
            const debugElement = document.getElementById('voiceDebugInfo');
            
            let html = '<h4>üîç Available Voices on Your Device:</h4>';
            
            voices.forEach((voice, index) => {
                const isFemale = voice.name.toLowerCase().includes('female') || 
                                voice.name.toLowerCase().includes('woman') ||
                                ['zira', 'samantha', 'karen', 'emma', 'amy', 'aria', 'fiona'].some(name => 
                                    voice.name.toLowerCase().includes(name));
                
                const color = isFemale ? '#4CAF50' : '#f44336';
                const gender = isFemale ? 'üë© Female' : 'üë® Male/Unknown';
                
                html += `
                    <div style="background: rgba(255,255,255,0.1); padding: 8px; margin: 3px 0; border-radius: 3px; border-left: 4px solid ${color};">
                        <strong>${voice.name}</strong> (${voice.lang}) ${gender}
                        <button onclick="testVoice(${index})" style="background: #2196F3; color: white; border: none; padding: 2px 8px; border-radius: 3px; margin-left: 10px; cursor: pointer;">Test</button>
                    </div>
                `;
            });
            
            debugElement.innerHTML = html;
        }

        function testVoice(voiceIndex) {
            const voices = synthesis.getVoices();
            const voice = voices[voiceIndex];
            
            if (voice) {
                const utterance = new SpeechSynthesisUtterance("Hello, I'm Nakato Jane testing this voice.");
                utterance.voice = voice;
                utterance.rate = 0.8;
                utterance.pitch = 1.4;
                utterance.volume = 0.9;
                
                synthesis.speak(utterance);
                
                document.getElementById('recordingStatus').innerHTML = 
                    `üéµ Testing voice: ${voice.name} (${voice.lang})`;
            }
        }

        function forceFemalevoice() {
            const testText = "Hello! I'm Nakato Jane, and this is my female voice.";
            
            // Force use female voice with high pitch
            if (synthesis) {
                const utterance = new SpeechSynthesisUtterance(testText);
                const voices = synthesis.getVoices();
                
                // Find best female voice
                let femaleVoice = null;
                const femaleNames = ['zira', 'samantha', 'karen', 'emma', 'amy', 'female'];
                
                for (let name of femaleNames) {
                    for (let voice of voices) {
                        if (voice.name.toLowerCase().includes(name)) {
                            femaleVoice = voice;
                            break;
                        }
                    }
                    if (femaleVoice) break;
                }
                
                if (femaleVoice) {
                    utterance.voice = femaleVoice;
                    utterance.pitch = 1.8; // Very high pitch for clear female sound
                    utterance.rate = 0.7;
                    utterance.volume = 0.95;
                    
                    synthesis.speak(utterance);
                    
                    document.getElementById('recordingStatus').innerHTML = 
                        `üë© Forced female voice: ${femaleVoice.name}`;
                } else {
                    // No female voice found, use high pitch
                    utterance.pitch = 2.0; // Maximum pitch
                    utterance.rate = 0.6;
                    synthesis.speak(utterance);
                    
                    document.getElementById('recordingStatus').innerHTML = 
                        `‚ö†Ô∏è No female voice found. Using high pitch on default voice.`;
                }
            }
        }

        // Load voices when available
        if (synthesis) {
            synthesis.onvoiceschanged = function() {
                // Voices are now loaded
            };
        }

        // Initialize the voice samples list on page load
        updateVoiceSamplesList();
        updateVoiceModelStatus();

        // Check if voice model is already trained and show status
        const isModelTrained = localStorage.getItem('nakatoVoiceModelTrained') === 'true';
        
        if (isModelTrained && recordedVoiceSamples.length > 0) {
            document.getElementById('recordingStatus').innerHTML = 
                `‚úÖ <strong>Nakato Jane's personalized voice is ready!</strong> Ask her a question to hear the cloned voice.`;
        } else if (recordedVoiceSamples.length > 0) {
            document.getElementById('recordingStatus').innerHTML = 
                `üìÅ ${recordedVoiceSamples.length} voice samples uploaded. Click "üß† Train Voice Model" to activate personalized voice.`;
        }
        
        // Initialize speech recognition when page loads
        initializeSpeechRecognition();
        
        // Add event listener to microphone button as backup
        document.addEventListener('DOMContentLoaded', function() {
            const micButton = document.getElementById('micButton');
            if (micButton) {
                console.log('‚úÖ Microphone button found, adding event listeners');
                
                // Add both onclick and addEventListener for reliability
                micButton.addEventListener('click', function(e) {
                    console.log('üîò Microphone button clicked via addEventListener');
                    e.preventDefault();
                    toggleListening();
                });
                
                // Test button functionality
                console.log('üß™ Testing microphone button...');
                if (typeof toggleListening === 'function') {
                    console.log('‚úÖ toggleListening function is available');
                } else {
                    console.error('‚ùå toggleListening function not found');
                }
            } else {
                console.error('‚ùå Microphone button not found');
            }
        });
        
        // Initialize AI
        console.log('üöÄ Nakato Jane Voice Assistant initialized');
    </script>
</body>
</html>
