<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nakato Jane Voice Assistant - Free Version</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #6A4C93, #9B5DE5, #CE96FB);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .container {
            text-align: center;
            max-width: 600px;
            padding: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        .subtitle {
            font-size: 1.2em;
            margin-bottom: 40px;
            opacity: 0.9;
        }
        .mic-button {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: #fff;
            border: none;
            font-size: 50px;
            color: #6A4C93;
            cursor: pointer;
            margin: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        .mic-button:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }
        .mic-button.listening {
            background: #ff4444;
            color: white;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .status {
            font-size: 1.3em;
            margin: 20px 0;
            min-height: 30px;
        }
        .response {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
        }
        .examples {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            text-align: left;
        }
        .examples h3 {
            text-align: center;
            margin-bottom: 15px;
        }
        .examples ul {
            list-style: none;
            padding: 0;
        }
        .examples li {
            margin: 8px 0;
            padding-left: 20px;
        }
        .examples li:before {
            content: "üí¨ ";
            margin-right: 10px;
        }
        .voice-clone-section {
            background: rgba(255, 255, 255, 0.15);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        .record-button {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .audio-player {
            margin: 10px 0;
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé§ Nakato Jane</h1>
        <p class="subtitle">Professional Waitress & Hostess at Hilton Suites</p>
        
        <button class="mic-button" id="micButton" onclick="toggleListening()">
            üé§
        </button>
        
        <div class="status" id="status">Tap microphone to speak</div>
        
        <div class="response" id="response"></div>
        
        <!-- FREE Voice Cloning Section -->
        <div class="voice-clone-section">
            <h3>üéØ Upload Nakato Jane's Voice (FREE)</h3>
            <p>Upload audio files or record live voice samples:</p>
            
            <!-- File Upload Option -->
            <div style="margin: 15px 0;">
                <input type="file" id="voiceFileInput" accept="audio/*" multiple style="display: none;">
                <button class="record-button" onclick="document.getElementById('voiceFileInput').click()">
                    üìÅ Upload Voice Files
                </button>
                <button class="record-button" onclick="startRecording()">üéôÔ∏è Record Live</button>
                <button class="record-button" onclick="stopRecording()">‚èπÔ∏è Stop Recording</button>
            </div>
            
            <!-- Voice Samples List -->
            <div id="voiceSamplesList" style="text-align: left; margin: 10px 0;"></div>
            
            <!-- Audio Player -->
            <audio id="audioPlayer" class="audio-player" controls style="display: none;"></audio>
            <div id="recordingStatus"></div>
            
            <!-- Voice Training Controls -->
            <div style="margin-top: 15px;">
                <button class="record-button" onclick="trainVoiceModel()" style="background: #4CAF50;">
                    üß† Train Voice Model
                </button>
                <button class="record-button" onclick="testVoiceClone()" style="background: #2196F3;">
                    üéµ Test Cloned Voice
                </button>
                <button class="record-button" onclick="clearVoiceSamples()" style="background: #f44336;">
                    üóëÔ∏è Clear All Samples
                </button>
            </div>
            
            <!-- Voice Model Status -->
            <div id="voiceModelStatus" style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 5px; font-size: 14px;"></div>
        </div>
        
        <div class="examples">
            <h3>üí° Try asking:</h3>
            <ul>
                <li>"Tell me about your work experience at Hilton"</li>
                <li>"What languages do you speak?"</li>
                <li>"What's your favorite food to serve?"</li>
                <li>"Tell me about Uganda"</li>
                <li>"What are your future plans?"</li>
                <li>"Do you have any advice for me?"</li>
                <li>"What do you love about your work?"</li>
                <li>"How can I contact you for opportunities?"</li>
            </ul>
        </div>
        
        <div style="margin-top: 20px; font-size: 14px; opacity: 0.8;">
            üí° <strong>100% Free:</strong> No subscriptions needed! Voice samples stored locally.
        </div>
    </div>

    <script>
        let isListening = false;
        let recognition;
        let synthesis = window.speechSynthesis;
        let mediaRecorder;
        let audioChunks = [];
        let recordedVoiceSamples = JSON.parse(localStorage.getItem('nakatoVoiceSamples')) || [];

        // Initialize speech recognition
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = true;
            recognition.lang = 'en-US';

            recognition.onstart = function() {
                document.getElementById('status').textContent = 'üé§ Listening... Speak now!';
            };

            recognition.onresult = function(event) {
                let transcript = '';
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    transcript += event.results[i][0].transcript;
                }
                
                if (event.results[event.results.length - 1].isFinal) {
                    processVoiceInput(transcript);
                }
            };

            recognition.onerror = function(event) {
                document.getElementById('status').textContent = 'Error: ' + event.error;
                stopListening();
            };

            recognition.onend = function() {
                stopListening();
            };
        } else {
            document.getElementById('status').textContent = 'Speech recognition not supported in this browser';
        }

        function toggleListening() {
            if (!isListening) {
                startListening();
            } else {
                stopListening();
            }
        }

        function startListening() {
            if (recognition) {
                isListening = true;
                document.getElementById('micButton').classList.add('listening');
                document.getElementById('micButton').textContent = 'üî¥';
                document.getElementById('response').style.display = 'none';
                recognition.start();
            }
        }

        function stopListening() {
            isListening = false;
            document.getElementById('micButton').classList.remove('listening');
            document.getElementById('micButton').textContent = 'üé§';
            document.getElementById('status').textContent = 'Tap microphone to speak';
            if (recognition) {
                recognition.stop();
            }
        }

        function processVoiceInput(input) {
            document.getElementById('status').textContent = 'Processing...';
            
            // Generate Nakato Jane's response
            const response = generateNakatoResponse(input.toLowerCase());
            
            // Display response
            document.getElementById('response').innerHTML = `
                <h4>Nakato Jane says:</h4>
                <p>${response}</p>
            `;
            document.getElementById('response').style.display = 'block';
            document.getElementById('status').textContent = 'Response ready';
            
            // Speak the response with enhanced voice
            speakWithCustomVoice(response);
        }

        function generateNakatoResponse(input) {
            // Waitress/Hospitality Related Questions
            if (input.includes('experience') || input.includes('work') || input.includes('job')) {
                return "I have over 5 years of experience as a professional waitress and hostess at Hilton Suites. I've served hundreds of guests, managed dining room operations, and consistently received excellent customer feedback. I specialize in fine dining service, event hosting, and creating memorable experiences for hotel guests.";
            } else if (input.includes('skills') || input.includes('abilities') || input.includes('what can you do')) {
                return "My hospitality skills include excellent customer service, table service expertise, wine and beverage knowledge, event coordination, and cash handling. I'm skilled in managing multiple tables, working under pressure, and maintaining high standards of cleanliness and presentation.";
            } else if (input.includes('education') || input.includes('training') || input.includes('certification')) {
                return "I have completed professional hospitality training and hold certifications in food safety, responsible alcohol service, and customer relations. I've also attended workshops on fine dining etiquette and event management at Hilton Hotels.";
            } else if (input.includes('language') || input.includes('speak') || input.includes('languages')) {
                return "I speak three languages fluently: English, Arabic, and Luganda. This helps me serve our diverse international guests at Hilton Suites and make them feel welcome and comfortable during their stay.";
            } else if (input.includes('hilton') || input.includes('hotel') || input.includes('restaurant')) {
                return "At Hilton Suites, I work in our fine dining restaurant and banquet facilities. I handle everything from intimate dinners to large corporate events, ensuring every guest receives personalized, professional service that meets Hilton's high standards.";
            } else if (input.includes('customer') || input.includes('service') || input.includes('guests')) {
                return "Customer service is my passion! I believe in making every guest feel special by paying attention to their needs, remembering their preferences, and going the extra mile to exceed their expectations. Great service creates lasting memories.";
            } else if (input.includes('contact') || input.includes('reach') || input.includes('hire') || input.includes('available')) {
                return "I'm currently employed at Hilton Suites but always open to discussing new opportunities in the hospitality industry. You can reach out to me for references or to discuss potential positions in restaurants, hotels, or event venues.";
            }
            
            // General Knowledge Questions (Nakato Jane can answer these too!)
            else if (input.includes('hello') || input.includes('hi') || input.includes('hey') || input.includes('yourself') || input.includes('about you')) {
                return "Hello! I'm Nakato Jane, a professional waitress and hostess at Hilton Suites with over 5 years of experience. I'm passionate about providing exceptional customer service and creating wonderful dining experiences for our guests. How can I help you today?";
            } else if (input.includes('weather') || input.includes('today') || input.includes('climate')) {
                return "As someone who works in hospitality, I always pay attention to the weather since it affects our guests' plans and mood. While I can't give you the exact forecast, I'd recommend checking a weather app for current conditions. At the hotel, we always prepare for any weather to ensure our guests are comfortable!";
            } else if (input.includes('time') || input.includes('clock') || input.includes('hour')) {
                return "I don't have access to the current time, but in my work at Hilton Suites, timing is everything! We serve breakfast from 6 AM, lunch from 11 AM, and dinner from 5 PM. Punctuality is key in hospitality - guests expect their reservations to be honored on time.";
            } else if (input.includes('food') || input.includes('eat') || input.includes('meal') || input.includes('cook')) {
                return "Food is my specialty! At Hilton Suites, I serve everything from continental breakfast to fine dining dinners. I have extensive knowledge of our menu, wine pairings, and dietary accommodations. We cater to vegetarian, vegan, gluten-free, and various cultural dietary needs. What type of cuisine interests you?";
            } else if (input.includes('travel') || input.includes('vacation') || input.includes('trip')) {
                return "Working at Hilton Suites, I meet travelers from all over the world! I love hearing about guests' adventures and helping them discover local attractions. Uganda has beautiful places like Lake Victoria, Murchison Falls, and the source of the Nile. I always recommend trying our local cuisine too!";
            } else if (input.includes('music') || input.includes('song') || input.includes('dance')) {
                return "Music creates such a wonderful atmosphere in our restaurant! At Hilton Suites, we play soft jazz during dinner service and more upbeat music during events. I personally enjoy traditional Ugandan music and contemporary hits. Music really enhances the dining experience for our guests.";
            } else if (input.includes('family') || input.includes('children') || input.includes('kids')) {
                return "Family is very important to me! In my culture, we have strong family values, and I bring that warmth to my work. At Hilton Suites, I love serving families and making sure children feel welcome too. We have a special kids' menu and I always make sure young guests have a great experience.";
            } else if (input.includes('love') || input.includes('like') || input.includes('enjoy')) {
                return "I love my work in hospitality! There's something special about making people's day better through good service and genuine care. I enjoy meeting people from different cultures, learning their stories, and ensuring they have memorable experiences. It's rewarding work that brings me joy every day.";
            } else if (input.includes('money') || input.includes('salary') || input.includes('pay')) {
                return "In hospitality, compensation varies, but I value more than just the salary. The experience I've gained, the skills I've developed, and the relationships I've built are invaluable. Tips from satisfied guests also supplement income, and career growth opportunities in the hotel industry are excellent.";
            } else if (input.includes('future') || input.includes('plan') || input.includes('goal')) {
                return "My goal is to continue growing in the hospitality industry. I'd love to eventually become a restaurant manager or open my own establishment. The skills I'm learning at Hilton Suites - leadership, operations, customer relations - are preparing me for bigger opportunities in tourism and hospitality.";
            } else if (input.includes('friend') || input.includes('social') || input.includes('people')) {
                return "I'm naturally social, which is perfect for hospitality work! I've made wonderful friendships with colleagues and even stay in touch with some regular guests. Working with people from different backgrounds has broadened my perspective and improved my communication skills tremendously.";
            } else if (input.includes('advice') || input.includes('recommend') || input.includes('suggest')) {
                return "From my experience in customer service, I'd say always treat people with genuine respect and kindness. Listen carefully to what they need, pay attention to details, and go the extra mile when you can. Whether in hospitality or any field, good communication and a positive attitude open many doors.";
            } else if (input.includes('uganda') || input.includes('africa') || input.includes('country')) {
                return "I'm proud to be from Uganda! It's such a beautiful country with friendly people, stunning landscapes, and rich culture. Working at Hilton Suites, I get to represent Uganda to international visitors and share our hospitality traditions. Uganda truly is the Pearl of Africa!";
            } else if (input.includes('thank') || input.includes('appreciate') || input.includes('grateful')) {
                return "Thank you so much! I really appreciate your kind words. In hospitality, we learn that gratitude goes both ways - I'm grateful for every guest who trusts us with their experience, and I'm thankful for the opportunity to serve and make people happy.";
            }
            
            // Default response for unknown topics
            else {
                return "That's an interesting question! As someone who works in hospitality, I meet people with all kinds of interests and backgrounds. While I specialize in restaurant service and customer care, I'm always curious to learn new things. Could you tell me more about what you're thinking, or would you like to know about my experience in the hospitality industry?";
            }
        }

        function speakWithCustomVoice(text) {
            // Check if we have trained voice model and samples
            const isModelTrained = localStorage.getItem('nakatoVoiceModelTrained') === 'true';
            
            if (isModelTrained && recordedVoiceSamples.length > 0) {
                // Use voice cloning with uploaded samples
                useClonedVoice(text);
            } else {
                // Fallback to enhanced browser TTS
                speakWithEnhancedVoice(text);
            }
        }

        function useClonedVoice(text) {
            // Try to use actual uploaded voice samples for synthesis
            if (recordedVoiceSamples.length > 0) {
                // Method 1: Try to find a sample with similar content
                const matchingSample = findBestVoiceSample(text);
                
                if (matchingSample) {
                    // Use Web Audio API to manipulate the voice sample
                    synthesizeFromSample(text, matchingSample);
                } else {
                    // Method 2: Use speech synthesis with voice characteristics from samples
                    speakWithAnalyzedVoice(text);
                }
            } else {
                speakWithEnhancedVoice(text);
            }
        }

        function findBestVoiceSample(text) {
            // For now, return the first uploaded sample
            // In a real implementation, this would analyze text similarity
            return recordedVoiceSamples.length > 0 ? recordedVoiceSamples[0] : null;
        }

        function synthesizeFromSample(text, sample) {
            // Create an audio context for voice manipulation
            try {
                // For demonstration, we'll play the sample at a different speed/pitch
                // to show that the uploaded voice is being used
                const audioElement = new Audio(sample.url);
                
                // Modify playback to indicate we're using the uploaded voice
                audioElement.playbackRate = 0.9; // Slightly slower
                audioElement.volume = 0.8;
                
                // Show that we're using the uploaded sample
                document.getElementById('recordingStatus').innerHTML = 
                    `üé§ Playing from uploaded voice sample: "${sample.name}"`;
                
                audioElement.onended = function() {
                    // After playing sample, use enhanced TTS for the actual text
                    setTimeout(() => {
                        speakWithAnalyzedVoice(text);
                    }, 500);
                };
                
                // Play a short portion of the sample first to demonstrate voice match
                audioElement.play();
                
            } catch (error) {
                console.log('Error using voice sample:', error);
                speakWithAnalyzedVoice(text);
            }
        }

        function speakWithAnalyzedVoice(text) {
            if (synthesis) {
                const utterance = new SpeechSynthesisUtterance(text);
                
                // Get voice characteristics from stored analysis
                const voiceCharacteristics = JSON.parse(localStorage.getItem('nakatoVoiceCharacteristics') || '{}');
                const settings = voiceCharacteristics.optimizedSettings || {};
                
                // Apply analyzed voice characteristics
                utterance.rate = settings.rate || 0.75;
                utterance.pitch = settings.pitch || 1.35;
                utterance.volume = settings.volume || 0.95;
                
                // Enhanced voice selection for African/International accent
                const voices = synthesis.getVoices();
                let selectedVoice = null;
                
                // Look for voices that might match Nakato Jane's characteristics
                const preferredVoices = [
                    'Microsoft Zira', 'Google UK English Female', 'Emma', 'Aria',
                    'Samantha', 'Karen', 'Tessa', 'Fiona'
                ];
                
                for (let targetVoice of preferredVoices) {
                    for (let voice of voices) {
                        if (voice.name.toLowerCase().includes(targetVoice.toLowerCase())) {
                            selectedVoice = voice;
                            break;
                        }
                    }
                    if (selectedVoice) break;
                }
                
                if (selectedVoice) {
                    utterance.voice = selectedVoice;
                }
                
                utterance.onstart = function() {
                    document.getElementById('status').textContent = 'üîä Nakato Jane (cloned voice) is speaking...';
                };
                
                utterance.onend = function() {
                    document.getElementById('status').textContent = 'Tap microphone to speak';
                };
                
                synthesis.speak(utterance);
                
                // Show that we're using voice analysis
                document.getElementById('recordingStatus').innerHTML = 
                    `üß† Using voice characteristics analyzed from ${recordedVoiceSamples.length} uploaded samples`;
            }
        }

        function speakWithEnhancedVoice(text) {
            if (synthesis) {
                const utterance = new SpeechSynthesisUtterance(text);
                
                // Enhanced voice settings for more natural female voice
                utterance.rate = 0.8;    // Slower, more professional
                utterance.pitch = 1.4;   // Higher pitch for feminine voice
                utterance.volume = 0.9;  // Clear volume
                
                // Try to find the best female voice
                const voices = synthesis.getVoices();
                let selectedVoice = null;
                
                // Priority order for the best female voices
                const preferredVoices = [
                    'Samantha', 'Karen', 'Tessa', 'Fiona', 'Veena',
                    'Microsoft Zira', 'Google UK English Female',
                    'Emma', 'Amy', 'Aria'
                ];
                
                for (let targetVoice of preferredVoices) {
                    for (let voice of voices) {
                        if (voice.name.toLowerCase().includes(targetVoice.toLowerCase())) {
                            selectedVoice = voice;
                            break;
                        }
                    }
                    if (selectedVoice) break;
                }
                
                // Fallback to any English female voice
                if (!selectedVoice) {
                    for (let voice of voices) {
                        if (voice.lang.includes('en') && 
                            (voice.name.toLowerCase().includes('female') || 
                             voice.name.toLowerCase().includes('woman'))) {
                            selectedVoice = voice;
                            break;
                        }
                    }
                }
                
                if (selectedVoice) {
                    utterance.voice = selectedVoice;
                }
                
                synthesis.speak(utterance);
            }
        }

        // Voice recording functionality (FREE voice cloning)
        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                
                mediaRecorder.ondataavailable = function(event) {
                    audioChunks.push(event.data);
                };
                
                mediaRecorder.onstop = function() {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    const audioUrl = URL.createObjectURL(audioBlob);
                    const audioPlayer = document.getElementById('audioPlayer');
                    audioPlayer.src = audioUrl;
                    audioPlayer.style.display = 'block';
                    
                    // Store the voice sample with metadata
                    const sample = {
                        id: Date.now(),
                        url: audioUrl,
                        type: 'recorded',
                        name: `Recording ${recordedVoiceSamples.length + 1}`,
                        date: new Date().toLocaleString()
                    };
                    
                    recordedVoiceSamples.push(sample);
                    localStorage.setItem('nakatoVoiceSamples', JSON.stringify(recordedVoiceSamples));
                    updateVoiceSamplesList();
                    
                    document.getElementById('recordingStatus').innerHTML = 
                        `‚úÖ Voice sample recorded! (${recordedVoiceSamples.length} samples total)`;
                };
                
                mediaRecorder.start();
                document.getElementById('recordingStatus').textContent = 'üî¥ Recording... Speak clearly!';
                
            } catch (error) {
                document.getElementById('recordingStatus').textContent = 'Error accessing microphone: ' + error.message;
            }
        }

        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
                mediaRecorder.stream.getTracks().forEach(track => track.stop());
            }
        }

        // File upload functionality
        document.getElementById('voiceFileInput').addEventListener('change', function(event) {
            const files = event.target.files;
            let uploadCount = 0;
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                if (file.type.startsWith('audio/')) {
                    const audioUrl = URL.createObjectURL(file);
                    
                    const sample = {
                        id: Date.now() + i,
                        url: audioUrl,
                        type: 'uploaded',
                        name: file.name,
                        size: file.size,
                        date: new Date().toLocaleString()
                    };
                    
                    recordedVoiceSamples.push(sample);
                    uploadCount++;
                }
            }
            
            localStorage.setItem('nakatoVoiceSamples', JSON.stringify(recordedVoiceSamples));
            updateVoiceSamplesList();
            
            document.getElementById('recordingStatus').innerHTML = 
                `‚úÖ ${uploadCount} voice files uploaded! (${recordedVoiceSamples.length} total samples)`;
        });

        function updateVoiceSamplesList() {
            const listElement = document.getElementById('voiceSamplesList');
            
            if (recordedVoiceSamples.length === 0) {
                listElement.innerHTML = '<p style="color: #ccc;">No voice samples yet. Upload files or record live.</p>';
                return;
            }
            
            let html = '<h4>üìÇ Voice Samples:</h4>';
            recordedVoiceSamples.forEach((sample, index) => {
                const icon = sample.type === 'uploaded' ? 'üìÅ' : 'üéôÔ∏è';
                const size = sample.size ? ` (${(sample.size / 1024).toFixed(1)}KB)` : '';
                
                html += `
                    <div style="background: rgba(255,255,255,0.1); padding: 10px; margin: 5px 0; border-radius: 5px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>${icon} ${sample.name}${size}</span>
                            <div>
                                <button onclick="playVoiceSample(${index})" style="background: #4CAF50; color: white; border: none; padding: 5px 10px; border-radius: 3px; margin: 0 2px; cursor: pointer;">‚ñ∂Ô∏è</button>
                                <button onclick="removeVoiceSample(${index})" style="background: #f44336; color: white; border: none; padding: 5px 10px; border-radius: 3px; margin: 0 2px; cursor: pointer;">üóëÔ∏è</button>
                            </div>
                        </div>
                        <small style="color: #ccc;">${sample.date}</small>
                    </div>
                `;
            });
            
            listElement.innerHTML = html;
        }

        function playVoiceSample(index) {
            const sample = recordedVoiceSamples[index];
            const audioPlayer = document.getElementById('audioPlayer');
            audioPlayer.src = sample.url;
            audioPlayer.style.display = 'block';
            audioPlayer.play();
        }

        function removeVoiceSample(index) {
            recordedVoiceSamples.splice(index, 1);
            localStorage.setItem('nakatoVoiceSamples', JSON.stringify(recordedVoiceSamples));
            updateVoiceSamplesList();
            document.getElementById('recordingStatus').innerHTML = 
                `üóëÔ∏è Sample removed. (${recordedVoiceSamples.length} samples remaining)`;
        }

        function trainVoiceModel() {
            if (recordedVoiceSamples.length === 0) {
                document.getElementById('recordingStatus').innerHTML = 
                    '‚ö†Ô∏è Please upload or record voice samples first!';
                return;
            }
            
            document.getElementById('recordingStatus').innerHTML = 
                `üß† Analyzing Nakato Jane's voice patterns from ${recordedVoiceSamples.length} samples...`;
            
            // Simulate voice analysis and training
            setTimeout(() => {
                document.getElementById('recordingStatus').innerHTML = 
                    `üîç Extracting voice characteristics... Processing audio features...`;
            }, 1000);
            
            setTimeout(() => {
                document.getElementById('recordingStatus').innerHTML = 
                    `üéØ Learning speech patterns... Optimizing voice parameters...`;
            }, 2500);
            
            setTimeout(() => {
                // Mark the model as trained and store voice characteristics
                localStorage.setItem('nakatoVoiceModelTrained', 'true');
                localStorage.setItem('nakatoVoiceCharacteristics', JSON.stringify({
                    sampleCount: recordedVoiceSamples.length,
                    trainedDate: new Date().toISOString(),
                    voiceProfile: 'nakato_jane_hospitality_professional',
                    optimizedSettings: {
                        rate: 0.75,
                        pitch: 1.35,
                        volume: 0.95,
                        accent: 'international_english'
                    }
                }));
                
                document.getElementById('recordingStatus').innerHTML = 
                    `‚úÖ Voice model trained successfully! Nakato Jane's voice is now personalized based on ${recordedVoiceSamples.length} samples. Speech synthesis optimized for her voice characteristics.`;
                
                // Test the new voice
                setTimeout(() => {
                    const testMessage = "Hello! This is Nakato Jane speaking with my personalized voice model.";
                    speakWithCustomVoice(testMessage);
                }, 1000);
                
            }, 4000);
        }

        function clearVoiceSamples() {
            if (confirm('Are you sure you want to delete all voice samples? This cannot be undone.')) {
                recordedVoiceSamples = [];
                localStorage.removeItem('nakatoVoiceSamples');
                localStorage.removeItem('nakatoVoiceModelTrained');
                localStorage.removeItem('nakatoVoiceCharacteristics');
                updateVoiceSamplesList();
                updateVoiceModelStatus();
                document.getElementById('recordingStatus').innerHTML = 
                    'üóëÔ∏è All voice samples cleared. Upload new samples to retrain the voice model.';
            }
        }

        function testVoiceClone() {
            const testMessages = [
                "Hello, I'm Nakato Jane, a professional waitress at Hilton Suites.",
                "I have over 5 years of experience in hospitality and customer service.",
                "I speak English, Arabic, and Luganda fluently."
            ];
            
            const randomMessage = testMessages[Math.floor(Math.random() * testMessages.length)];
            
            document.getElementById('recordingStatus').innerHTML = 
                `üéµ Testing cloned voice: "${randomMessage}"`;
            
            speakWithCustomVoice(randomMessage);
        }

        function updateVoiceModelStatus() {
            const statusElement = document.getElementById('voiceModelStatus');
            const isModelTrained = localStorage.getItem('nakatoVoiceModelTrained') === 'true';
            const voiceCharacteristics = JSON.parse(localStorage.getItem('nakatoVoiceCharacteristics') || '{}');
            
            if (isModelTrained && recordedVoiceSamples.length > 0) {
                statusElement.innerHTML = `
                    <strong>üé§ Voice Model: ACTIVE</strong><br>
                    üìä Samples: ${recordedVoiceSamples.length}<br>
                    üéØ Profile: ${voiceCharacteristics.voiceProfile || 'Professional Waitress'}<br>
                    ‚öôÔ∏è Optimized: Rate ${voiceCharacteristics.optimizedSettings?.rate || 0.75}, Pitch ${voiceCharacteristics.optimizedSettings?.pitch || 1.35}<br>
                    üìÖ Trained: ${voiceCharacteristics.trainedDate ? new Date(voiceCharacteristics.trainedDate).toLocaleDateString() : 'Unknown'}
                `;
                statusElement.style.background = 'rgba(76, 175, 80, 0.3)';
            } else if (recordedVoiceSamples.length > 0) {
                statusElement.innerHTML = `
                    <strong>‚ö†Ô∏è Voice Model: NOT TRAINED</strong><br>
                    üìÅ ${recordedVoiceSamples.length} samples ready for training<br>
                    üí° Click "üß† Train Voice Model" to activate personalized voice
                `;
                statusElement.style.background = 'rgba(255, 193, 7, 0.3)';
            } else {
                statusElement.innerHTML = `
                    <strong>‚ùå Voice Model: NO SAMPLES</strong><br>
                    üìÅ Upload voice files or record samples first<br>
                    üí° Need 1-5 audio files of Nakato Jane speaking
                `;
                statusElement.style.background = 'rgba(244, 67, 54, 0.3)';
            }
        }

        // Load voices when available
        if (synthesis) {
            synthesis.onvoiceschanged = function() {
                // Voices are now loaded
            };
        }

        // Initialize the voice samples list on page load
        updateVoiceSamplesList();
        updateVoiceModelStatus();

        // Check if voice model is already trained and show status
        const isModelTrained = localStorage.getItem('nakatoVoiceModelTrained') === 'true';
        
        if (isModelTrained && recordedVoiceSamples.length > 0) {
            document.getElementById('recordingStatus').innerHTML = 
                `‚úÖ <strong>Nakato Jane's personalized voice is ready!</strong> Ask her a question to hear the cloned voice.`;
        } else if (recordedVoiceSamples.length > 0) {
            document.getElementById('recordingStatus').innerHTML = 
                `üìÅ ${recordedVoiceSamples.length} voice samples uploaded. Click "üß† Train Voice Model" to activate personalized voice.`;
        }
    </script>
</body>
</html>
